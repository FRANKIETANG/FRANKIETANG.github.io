<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="用 Node 来搭建 HTTP 服务器https://github.com/FRANKIETANG/simple-http-server 可以点进去看 commit URL全称是 Uniform Resource Locator （唯一的资源定位器？），相当于一个地址。 Schema://Host:Port/Path?query#hash  Schema =&amp;gt; 协议 Host =&amp;gt; 主">
<meta name="keywords" content="Node,HTTP">
<meta property="og:type" content="article">
<meta property="og:title" content="用 Node 来搭建 HTTP 服务器">
<meta property="og:url" content="http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/index.html">
<meta property="og:site_name" content="付林恒的博客">
<meta property="og:description" content="用 Node 来搭建 HTTP 服务器https://github.com/FRANKIETANG/simple-http-server 可以点进去看 commit URL全称是 Uniform Resource Locator （唯一的资源定位器？），相当于一个地址。 Schema://Host:Port/Path?query#hash  Schema =&amp;gt; 协议 Host =&amp;gt; 主">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://us1.myximage.com/2017/11/30/10814fc32bca783917e30c6f8245b5e5.png">
<meta property="og:image" content="https://us1.myximage.com/2017/11/30/07c50f626d106f548a94d6a079a69ac6.gif">
<meta property="og:image" content="https://us1.myximage.com/2017/11/30/f0f0708a615d98816c5dfac1a6188a49.gif">
<meta property="og:image" content="https://us1.myximage.com/2017/12/01/e73caf3a3b4d360703165be09147afea.gif">
<meta property="og:image" content="https://us1.myximage.com/2017/12/01/fcc0ec6f09967d75f4e2fdfdd6475138.gif">
<meta property="og:image" content="https://us1.myximage.com/2017/12/01/0eda1fdee399f2d5f16acd525d5f469a.gif">
<meta property="og:image" content="https://us1.myximage.com/2017/12/01/ca7f44d9c3c761bca5d419204b5a5ff0.gif">
<meta property="og:image" content="https://us1.myximage.com/2017/12/01/6a58999accae3fe5bcac42cb90ce1400.gif">
<meta property="og:updated_time" content="2017-12-01T15:13:00.504Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="用 Node 来搭建 HTTP 服务器">
<meta name="twitter:description" content="用 Node 来搭建 HTTP 服务器https://github.com/FRANKIETANG/simple-http-server 可以点进去看 commit URL全称是 Uniform Resource Locator （唯一的资源定位器？），相当于一个地址。 Schema://Host:Port/Path?query#hash  Schema =&amp;gt; 协议 Host =&amp;gt; 主">
<meta name="twitter:image" content="https://us1.myximage.com/2017/11/30/10814fc32bca783917e30c6f8245b5e5.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.jpg">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon.jpg" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.jpg">
          
        
    
    <!-- title -->
    <title>用 Node 来搭建 HTTP 服务器</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2017/11/29/补基础：node 各种知识点/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&text=用 Node 来搭建 HTTP 服务器"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&title=用 Node 来搭建 HTTP 服务器"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&is_video=false&description=用 Node 来搭建 HTTP 服务器"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=用 Node 来搭建 HTTP 服务器&body=Check out this article: http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&title=用 Node 来搭建 HTTP 服务器"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&title=用 Node 来搭建 HTTP 服务器"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&title=用 Node 来搭建 HTTP 服务器"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&title=用 Node 来搭建 HTTP 服务器"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&name=用 Node 来搭建 HTTP 服务器&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#用-Node-来搭建-HTTP-服务器"><span class="toc-number">1.</span> <span class="toc-text">用 Node 来搭建 HTTP 服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#URL"><span class="toc-number">1.1.</span> <span class="toc-text">URL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#举一个简单的例子"><span class="toc-number">1.1.1.</span> <span class="toc-text">举一个简单的例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP"><span class="toc-number">1.2.</span> <span class="toc-text">HTTP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#举一个简单的例子-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">举一个简单的例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#请求体"><span class="toc-number">1.2.2.</span> <span class="toc-text">请求体</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#假如用-Express-搭服务器"><span class="toc-number">1.3.</span> <span class="toc-text">假如用 Express 搭服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#彩蛋"><span class="toc-number">1.4.</span> <span class="toc-text">彩蛋</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#命令行神器"><span class="toc-number">1.4.1.</span> <span class="toc-text">命令行神器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#前端发送表单发送的数据-后端处理的方式"><span class="toc-number">1.4.2.</span> <span class="toc-text">前端发送表单发送的数据-后端处理的方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何做请求缓存"><span class="toc-number">1.4.3.</span> <span class="toc-text">如何做请求缓存</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        用 Node 来搭建 HTTP 服务器
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">付林恒的博客</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-12-01T15:03:36.000Z" itemprop="datePublished">2017-12-01</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/HTTP/">HTTP</a>, <a class="tag-link" href="/tags/Node/">Node</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="用-Node-来搭建-HTTP-服务器"><a href="#用-Node-来搭建-HTTP-服务器" class="headerlink" title="用 Node 来搭建 HTTP 服务器"></a>用 Node 来搭建 HTTP 服务器</h1><p><a href="https://github.com/FRANKIETANG/simple-http-server" target="_blank" rel="external">https://github.com/FRANKIETANG/simple-http-server</a></p>
<p>可以点进去看 <a href="https://github.com/FRANKIETANG/simple-http-server/commits/master" target="_blank" rel="external">commit</a></p>
<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p>全称是 Uniform Resource Locator （唯一的资源定位器？），相当于一个地址。</p>
<p><code>Schema://Host:Port/Path?query#hash</code></p>
<blockquote>
<p>Schema =&gt; 协议</p>
<p>Host =&gt; 主姓名</p>
<p>Port =&gt; 端口号，比如 22 -&gt; ssh | 80 -&gt; http | 443 -&gt; https | mongodb -&gt; 27017</p>
<p>Path =&gt; 路径</p>
<p>query =&gt; 查询字符串</p>
<p>hash =&gt; 哈希</p>
</blockquote>
<pre><code>// 举个例子
const url = `address://nanshan.shenzhen.china/shennandadao/10869`
// 地址是://南山.深圳.中国/深南大道/10869号
// Host:Port 可以写 IP 地址或者域名
// 域名 -&gt; DNS (去 google)
</code></pre><h3 id="举一个简单的例子"><a href="#举一个简单的例子" class="headerlink" title="举一个简单的例子"></a>举一个简单的例子</h3><p><a href="https://segmentfault.com/a/1190000009084576" target="_blank" rel="external">vscode 断点调试</a></p>
<p>最好用 <strong>postman</strong>，浏览器好像只支持 get 请求。</p>
<pre><code>const http = require(&#39;http&#39;) // http 模块是一定的
const server = http.createServer()
server.listen(8282)
const querystring = require(&#39;querystring&#39;) // 引入 querystring 模块用来看 url 的 query

server.on(&#39;request&#39;, (request, response) =&gt; { // 受到请求后调用一次
    // console.log(request.url)  // 这里会打印出 /，实际上是 url Path 后的东西，如果我在 loaclhost:8282 后面写上 show-me-something，后台就会返回 /show-me-something，再加点东西也是同理的
    const url = request.url

    const queryString = url.substr(url.indexOf(&#39;?&#39;) + 1, url.length)

    const query = querystring.parse(queryString)

    console.log(query)

    // console.log(url)

    let responseStr // 定义返回字符串，收到 url 做出不同的返回值

    if (url.indexOf(&#39;/hello&#39;) &gt; -1) { // 记得加前缀 /
        responseStr = &#39;hi there&#39;
        if (query.i_need_money === &#39;true&#39; &amp;&amp; Number(query.how_much) &gt; 500) {  // 这里做一个判断他是不是要钱，值得一提的是这里这个 &#39;true&#39;，因为这里是没有类型的所以要用这个 &#39;true&#39;
            responseStr = &#39;go away&#39;
        } else {
            responseStr = &#39;ok, here you are&#39;
        }
    } else if (url.indexOf(&#39;/bye&#39;) &gt; -1) {  // 也可以用正则，不过如果写不好就会比 indexOf 要慢很多很多...
        responseStr = &#39;see ya next time&#39;
    } else {
        responseStr = &#39;i cant understand what you are saying&#39;
    }

    response.statusCode = 200
    response.end(responseStr)
    // response.end(&#39;this is my first http server&#39;)
})
</code></pre><pre><code>// postman 的操作
// 后台信息都是靠 console.log

localhost:8282/hello  // GET hi there | 后台 /hello
localhost:8282/bye  // GET see ya next time | 后台 /bye
localhost:8282/  // GET i cant understand what you are saying | 后台 /

// 加上 query
localhost:8282/hello?i_need_money=true  // GET i cant understand what you are saying | 后台 /hello?i_need_money=true

// 引入 querystring 模块后再打印
localhost:8282/hello?i_need_money=true  // GET i cant understand what you are saying | 后台 { i_need_money: &#39;true&#39; }
localhost:8282/hello?i_need_money=true&amp;how_much=1000  // GET i cant understand what you are saying | 后台 { i_need_money: &#39;true&#39;, how_much: &#39;1000&#39; }

// hello 模块做好判断后
localhost:8282/hello?i_need_money=true&amp;how_much=1000  // GET go away | 后台 { i_need_money: &#39;true&#39;, how_much: &#39;1000&#39; }
localhost:8282/hello?i_need_money=true&amp;how_much=300  // GET ok, here you are | 后台 { i_need_money: &#39;true&#39;, how_much: &#39;300&#39; }
</code></pre><h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>以百度为例子</p>
<p><img src="https://us1.myximage.com/2017/11/30/10814fc32bca783917e30c6f8245b5e5.png" alt=""></p>
<blockquote>
<p>HTTP 请求第一部分（第一行）  <code>GET /index/ HTTP/1.1</code>  什么方法 | 什么路径 | 什么 HTTP 版本 </p>
<ul>
<li>HTTP 方法 =&gt; GET POST PATCH PUT DELETE OPTIONS HEAD</li>
<li>比如 <code>path: /user get:获取所有用户 | post:创建用户 | patch:修改用户信息 | put:创建 | delete:删除 | options:列举可进行的操作 | head:返回 head 信息</code></li>
</ul>
<p>HTTP 请求头 第二行到空行之前 重要的键值对有 Content-Type: 请求体的类型（编码、格式）Content-Length: 请求体的长度  Accept: 能够接收的返回体类型  Cookie: cookie 有多个键值对，中间有个等号，以分号为分隔符</p>
<p>HTTP 请求体和请求头以一个空行作为分隔符</p>
<p>HTTP 第三部分  请求体 http-request / response-body</p>
</blockquote>
<h3 id="举一个简单的例子-1"><a href="#举一个简单的例子-1" class="headerlink" title="举一个简单的例子"></a>举一个简单的例子</h3><p><a href="https://segmentfault.com/a/1190000009084576" target="_blank" rel="external">vscode 断点调试</a></p>
<p>最好用 <strong>postman</strong>，浏览器好像只支持 get 请求。</p>
<pre><code>const http = require(&#39;http&#39;) // http 模块是一定的
const server = http.createServer()
server.listen(8282)
const querystring = require(&#39;querystring&#39;) // 引入 querystring 模块用来看 url 的 query

const users = [];  // 做一个全局数组

server.on(&#39;request&#39;, (request, response) =&gt; { // 受到请求后调用一次
    // console.log(request.url)  // 这里会打印出 /，实际上是 url Path 后的东西，如果我在 loaclhost:8282 后面写上 show-me-something，后台就会返回 /show-me-something，再加点东西也是同理的
    const url = request.url

    const path = url.substr(0, url.indexOf(&#39;?&#39;))

    const queryString = url.substr(url.indexOf(&#39;?&#39;) + 1, url.length)

    const query = querystring.parse(queryString)

    // console.log(query)
    // console.log(url)
    // console.log(path)

    // 做一个请求例子
    switch (path) {
        case &#39;/user&#39;:
            switch (request.method) {
                case &#39;GET&#39;:
                    response.statusCode = 200
                    response.end(JSON.stringify(users))
                    break;
                case &#39;POST&#39;:

                    break
            }
            break
        default:
            response.statusCode = 404
            response.end(&#39;NOT_FOUND&#39;)
            break
    }

})
</code></pre><pre><code>// postman 的操作
// 后台信息都是靠 console.log

localhost:8282/user?frankie=1  // GET [] 因为是第一次请求所以user什么都没有

// 文字太难表达了...看下面动图吧
// 也就是通过post创建的用户
</code></pre><p><img src="https://us1.myximage.com/2017/11/30/07c50f626d106f548a94d6a079a69ac6.gif" alt=""></p>
<pre><code>// 通过发送 json 定义用户
const http = require(&#39;http&#39;) // http 模块是一定的
const server = http.createServer()
server.listen(8282)
const querystring = require(&#39;querystring&#39;) // 引入 querystring 模块用来看 url 的 query

const users = [];  // 做一个全局数组

server.on(&#39;request&#39;, (request, response) =&gt; { // 受到请求后调用一次
    // console.log(request.url)  // 这里会打印出 /，实际上是 url Path 后的东西，如果我在 loaclhost:8282 后面写上 show-me-something，后台就会返回 /show-me-something，再加点东西也是同理的
    const url = request.url

    const path = url.substr(0, url.indexOf(&#39;?&#39;))

    const queryString = url.substr(url.indexOf(&#39;?&#39;) + 1, url.length)

    const query = querystring.parse(queryString)

    console.log(query)
    console.log(url)
    console.log(path)

    // 做一个请求例子
    // 其他方法也是一样的
    switch (path) {
        case &#39;/user&#39;:
            switch (request.method) {
                case &#39;GET&#39;:
                    response.statusCode = 200
                    response.end(JSON.stringify(users))
                    break;
                case &#39;POST&#39;:
                    const contentType = request.headers[&#39;content-type&#39;]  // 看请求头的属性

                    if (contentType !== &#39;application/json&#39;) {  // 不是json就400
                        response.statusCode = 400
                        response.end(&#39;error&#39;)
                    }

                    let requestBodyStr = &#39;&#39;
                    request.on(&#39;data&#39;, (data) =&gt; {
                        requestBodyStr += data.toString()  // 把json变成字符串
                    })
                    request.on(&#39;end&#39;, () =&gt; {
                        const user = JSON.parse(requestBodyStr)  // 解析josn字符串
                        users.push(user)
                        response.statusCode = 200
                        response.end(JSON.stringify(user))
                    })

                    // const user = { name: Math.floor(Math.random() * 100) }
                    // users.push(user)
                    // response.statusCode = 200
                    // response.end(JSON.stringify(user))
                    break
            }
            break
        default:
            response.statusCode = 404
            response.end(&#39;NOT_FOUND&#39;)
            break
    }

})
</code></pre><p><img src="https://us1.myximage.com/2017/11/30/f0f0708a615d98816c5dfac1a6188a49.gif" alt=""></p>
<h3 id="请求体"><a href="#请求体" class="headerlink" title="请求体"></a>请求体</h3><p>请求体的格式、编码通常由请求头里的 Content-type 指定，可能会很大（例如 form 格式可以请求 flie，分分钟 几十兆几百兆）（关键词 Buffer，一次吃不下我就一口一口吃）</p>
<pre><code>// 把上面那段代码改一下

const http = require(&#39;http&#39;) // http 模块是一定的
const server = http.createServer()
server.listen(8282)
const querystring = require(&#39;querystring&#39;) // 引入 querystring 模块用来看 url 的 query

const users = []; // 做一个全局数组

server.on(&#39;request&#39;, (request, response) =&gt; { // 受到请求后调用一次
    // console.log(request.url)  // 这里会打印出 /，实际上是 url Path 后的东西，如果我在 loaclhost:8282 后面写上 show-me-something，后台就会返回 /show-me-something，再加点东西也是同理的
    const url = request.url

    const path = url.substr(0, url.indexOf(&#39;?&#39;))

    const queryString = url.substr(url.indexOf(&#39;?&#39;) + 1, url.length)

    const query = querystring.parse(queryString)

    console.log(query)
    console.log(url)
    console.log(path)

    // 做一个请求例子
    // 其他方法也是一样的
    switch (path) {
        case &#39;/user&#39;:
            switch (request.method) {
                case &#39;GET&#39;:
                    response.statusCode = 200
                    response.end(JSON.stringify(users))
                    break;
                case &#39;POST&#39;:
                    const contentType = request.headers[&#39;content-type&#39;] // 看请求头的属性

                    if (contentType !== &#39;application/json&#39;) { // 不是json就400
                        response.statusCode = 400
                        response.end(&#39;error&#39;)
                    }

                    let requestBodyStr = &#39;&#39;
                    request.on(&#39;data&#39;, (data) =&gt; { // 当这个请求收到数据的时候
                        console.log(data) // 看看 data 
                    })
                    request.on(&#39;end&#39;, () =&gt; { // 当发过来的这个请求体已经结束的时候
                        response.end(&#39;done&#39;)
                    })
                    break
            }
            break
        default:
            response.statusCode = 404
            response.end(&#39;NOT_FOUND&#39;)
            break
    }

})
</code></pre><p>然后发点数据</p>
<p><img src="https://us1.myximage.com/2017/12/01/e73caf3a3b4d360703165be09147afea.gif" alt=""></p>
<p>可以看到是一个 <code>&lt;Buffer&gt;</code> 这个其实相当于吃了一小口，那我试试传个大家伙</p>
<pre><code>// 再修改一下代码
const http = require(&#39;http&#39;) // http 模块是一定的
const server = http.createServer()
server.listen(8282)
const querystring = require(&#39;querystring&#39;) // 引入 querystring 模块用来看 url 的 query

const users = []; // 做一个全局数组

server.on(&#39;request&#39;, (request, response) =&gt; { // 受到请求后调用一次
    // console.log(request.url)  // 这里会打印出 /，实际上是 url Path 后的东西，如果我在 loaclhost:8282 后面写上 show-me-something，后台就会返回 /show-me-something，再加点东西也是同理的
    const url = request.url

    const path = url.substr(0, url.indexOf(&#39;?&#39;))

    const queryString = url.substr(url.indexOf(&#39;?&#39;) + 1, url.length)

    const query = querystring.parse(queryString)

    console.log(query)
    console.log(url)
    console.log(path)

    // 做一个请求例子
    // 其他方法也是一样的
    switch (path) {
        case &#39;/user&#39;:
            switch (request.method) {
                case &#39;GET&#39;:
                    response.statusCode = 200
                    response.end(JSON.stringify(users))
                    break;
                case &#39;POST&#39;:
                    const contentType = request.headers[&#39;content-type&#39;] // 看请求头的属性

                    // if (contentType !== &#39;application/json&#39;) { // 不是json就400
                    //     response.statusCode = 400
                    //     response.end(&#39;error&#39;)
                    // }

                    let dataCount = 0
                    let requestBodyStr = &#39;&#39;
                    request.on(&#39;data&#39;, (data) =&gt; { // 当这个请求收到数据的时候
                        dataCount++
                        console.log(data)
                    })
                    request.on(&#39;end&#39;, () =&gt; { // 当发过来的这个请求体已经结束的时候
                        console.log(dataCount) // 看看一个文件要吃多少口
                        response.end(dataCount + &#39;&#39;)
                    })
                    break
            }
            break
        default:
            response.statusCode = 404
            response.end(&#39;NOT_FOUND&#39;)
            break
    }

})
</code></pre><p>然后发个算大的文件（48M）</p>
<p><img src="https://us1.myximage.com/2017/12/01/fcc0ec6f09967d75f4e2fdfdd6475138.gif" alt=""></p>
<p>也就是说这个大东西吃了 873 口</p>
<h2 id="假如用-Express-搭服务器"><a href="#假如用-Express-搭服务器" class="headerlink" title="假如用 Express 搭服务器"></a>假如用 Express 搭服务器</h2><p>先看看 bin/www 的代码</p>
<pre><code>// 7行和9行
var app = require(&#39;../app&#39;);  // 定义各种路由
var http = require(&#39;http&#39;);  // 引入http模块

// 28行
server.listen(port);  // 定义端口号
</code></pre><p>怎么把刚刚我上面实现的效果用 Express 框架做出来呢？</p>
<pre><code>// app.js 26行改成
app.use(&#39;/user&#39;, users);

// 打开 routes 的 users.js，修改成
var express = require(&#39;express&#39;)
var router = express.Router()

const users = []

/* GET users listing. */
router.route(&#39;/&#39;)
  .get((req, res, next) =&gt; {
    res.json(users)
  })
  .post((req, res)=&gt;{
    const user = req.body
    users.push(user)
    res.json(user)
  })

module.exports = router
</code></pre><p><img src="https://us1.myximage.com/2017/12/01/0eda1fdee399f2d5f16acd525d5f469a.gif" alt=""></p>
<p>其实框架还是解决了很多自己写东西的细节，像什么判断啊，转码啊啥的。那就可以不用管那么多直接写业务逻辑。</p>
<h2 id="彩蛋"><a href="#彩蛋" class="headerlink" title="彩蛋"></a>彩蛋</h2><h3 id="命令行神器"><a href="#命令行神器" class="headerlink" title="命令行神器"></a>命令行神器</h3><p>又发现了个命令行神器..</p>
<p><a href="https://github.com/robbyrussell/oh-my-zsh" target="_blank" rel="external">oh-my-zsh</a></p>
<h3 id="前端发送表单发送的数据-后端处理的方式"><a href="#前端发送表单发送的数据-后端处理的方式" class="headerlink" title="前端发送表单发送的数据-后端处理的方式"></a>前端发送表单发送的数据-后端处理的方式</h3><p><a href="https://github.com/FRANKIETANG/simple-http-server/commit/4366e9a1cc5506c7291b3550aa1ec2843644e817" target="_blank" rel="external">commit - form data</a></p>
<p><img src="https://us1.myximage.com/2017/12/01/ca7f44d9c3c761bca5d419204b5a5ff0.gif" alt=""></p>
<p>拿到数据了…（请忽略我的 JSON 报错）</p>
<p><a href="https://github.com/FRANKIETANG/simple-http-server/commit/1fdc106bf64cb242d53008b4f93b5c86b53af408" target="_blank" rel="external">commit - querystring replace JSON</a></p>
<p><img src="https://us1.myximage.com/2017/12/01/6a58999accae3fe5bcac42cb90ce1400.gif" alt=""></p>
<h3 id="如何做请求缓存"><a href="#如何做请求缓存" class="headerlink" title="如何做请求缓存"></a>如何做请求缓存</h3><p>就是收到第二次同样的请求返回一样的内容（先留个坑吧…）</p>
<ul>
<li>浏览器缓存</li>
<li>服务端缓存</li>
</ul>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#用-Node-来搭建-HTTP-服务器"><span class="toc-number">1.</span> <span class="toc-text">用 Node 来搭建 HTTP 服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#URL"><span class="toc-number">1.1.</span> <span class="toc-text">URL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#举一个简单的例子"><span class="toc-number">1.1.1.</span> <span class="toc-text">举一个简单的例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP"><span class="toc-number">1.2.</span> <span class="toc-text">HTTP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#举一个简单的例子-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">举一个简单的例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#请求体"><span class="toc-number">1.2.2.</span> <span class="toc-text">请求体</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#假如用-Express-搭服务器"><span class="toc-number">1.3.</span> <span class="toc-text">假如用 Express 搭服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#彩蛋"><span class="toc-number">1.4.</span> <span class="toc-text">彩蛋</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#命令行神器"><span class="toc-number">1.4.1.</span> <span class="toc-text">命令行神器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#前端发送表单发送的数据-后端处理的方式"><span class="toc-number">1.4.2.</span> <span class="toc-text">前端发送表单发送的数据-后端处理的方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何做请求缓存"><span class="toc-number">1.4.3.</span> <span class="toc-text">如何做请求缓存</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&text=用 Node 来搭建 HTTP 服务器"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&title=用 Node 来搭建 HTTP 服务器"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&is_video=false&description=用 Node 来搭建 HTTP 服务器"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=用 Node 来搭建 HTTP 服务器&body=Check out this article: http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&title=用 Node 来搭建 HTTP 服务器"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&title=用 Node 来搭建 HTTP 服务器"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&title=用 Node 来搭建 HTTP 服务器"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&title=用 Node 来搭建 HTTP 服务器"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2017/12/01/用 Node 来搭建 HTTP 服务器/&name=用 Node 来搭建 HTTP 服务器&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2017 Frankie Tang
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->


